<?php $__env->startSection('title'); ?>
Pricing and Charts
<?php $__env->stopSection(); ?>
<?php $__env->startSection('content'); ?>
	<section class="content" id="pricing">
        <?php if(Session::has('global')): ?>
            <div class="alert alert-success">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <?php echo e(Session::get('global')); ?>

            </div>
        <?php endif; ?>
        <?php if($setting->api_url == ''): ?>
            <div class="alert alert-danger">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                Please subscribe to ASX to get API url.
            </div>
        <?php endif; ?>
        <div class="row head-search">
            <div class="col-sm-12">
                <lable class="label-title">Pricing and Charts</lable>
            </div>
        </div>

    <h4 class="sub-title">SGX API</h4>
    <label>Insert new API <i class="fa fa-question-circle"> </i></label>
    <?php echo Form::open(array('route' => 'package.admin.stock.save-new-api')); ?>

	    <div class="row">
	        <div class="form-group">
	            <div class="col-md-9 col-sm-9">
	                <input type="text" class="form-control" name="api_url" id="" >
	                <?php echo $errors->first('api_url', '<span class="help-block">:message</span>'); ?>

	            </div>
	            <div class="col-md-3 col-sm-3">
	                <button type="submit" class="btn btn-primary btn-confirm">Confirm</button>
	            </div>
	        </div>
	    </div>
    <?php echo Form::close(); ?>


    <label>Current API</label>
    <div class="row">
        <div class="form-group">
            <div class="col-md-8 col-sm-8">
                <input type="text" class="form-control" value="<?php echo e($setting->api_url); ?>" disabled="" id="" >
            </div>
            <div class="col-md-4 col-sm-4">
                <?php echo Form::open(array('route' => 'package.admin.stock.remove-new-api', 'id'=>'frm_remove_api')); ?>

                    <button type="submit" class="btn btn-danger btn-remove_api" id="remove_api">Remove API</button>  
                <?php echo Form::close(); ?>

            </div>
        </div>
    </div>
    <h4 class="sub-title">Stock Charts</h4>
    <label>Lasted Weekly Chart</label>

    <div class="row">
        <div class="col-md-12">
            <div id="chartContainer" style=" width: 100%;">
            </div>
        </div>
    </div>

    <h4 class="sub-title">Stock Pricing</h4>
    <div class="row">
        <div class="col-md-4">
            <div class="form-group">
                <label>Price</label>
                <input type="text" disabled="" class="form-control" id="" value="$<?php echo e((isset($stock_value[0]['Close'])) ? $stock_value[0]['Close'] : '00.00'); ?>">
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label>Volume</label>
                <input type="text" disabled="" class="form-control" id="" value="<?php echo e((isset($stock_value[0]['Volume'])) ? number_format($stock_value[0]['Volume'], 0, '.', ',' ): '00.00'); ?>">
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label>Change</label>
                <input type="text" disabled="" class="form-control" id="" value="<?php echo e((isset($stock_value[0]['Movement'])) ? $stock_value[0]['Movement'] : '00.00'); ?>">
            </div>
        </div>

      


    </div>
    <label>Last Update: <?php echo e((isset($stock_value[0]['AsAt']))? date("D, d-M-Y | h:i a", strtotime($stock_value[0]['AsAt'])) : ''); ?></label>

    <div class="row">
        <div class="form-group">
            <div class="col-md-9 col-sm-9">
                <hr>
            </div>
            <div class="col-md-3 col-sm-3">
	                <button type="submit" class="btn btn-primary btn-confirm">Confirm</button>
	            </div>
        </div>
    </div>











    <h4 class="sub-title">Stock ID</h4>
    <label>Stock ID<i class="fa fa-question-circle"> </i></label>
    <?php echo Form::open(array('route' => 'package.admin.stock.stockid')); ?>

	    <div class="row">
	        <div class="form-group">
	            <div class="col-md-9 col-sm-9">
	                <input type="text" class="form-control" name="stockid" id=""  value="<?php echo e($setting->stockid); ?>" >
	                <?php echo $errors->first('stockid', '<span class="help-block">:message</span>'); ?>

	            </div>
	            <div class="col-md-3 col-sm-3">
	                <button type="submit" class="btn btn-primary btn-confirm">Confirm</button>
	            </div>
	        </div>
	    </div>
    <?php echo Form::close(); ?>









    </section>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('style'); ?>
	<?php echo Html::style('/css/client/pricing-charts.css'); ?>

        <style>
/*            #frm_remove_api .btn {
                border-radius: 0px !important;
            }*/
        </style>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('script'); ?>
    <?php echo Html::script('js/canvasjs.min.js'); ?>

<script type="text/javascript">
    $('.active').removeClass('active');
    $('.real_time_st').addClass('active');
    $('.real_time_st_list').addClass('active');
    
    window.onload = function () {
        $.ajaxSetup({
                headers:{
                    'X-CSRF-TOKEN':'<?php echo csrf_token(); ?>'
                }
            });
        loadChart();

        setInterval(function(){
          loadChart();
        }, 1200000);

    }

    function loadChart(){
        var chart_type = "<?php echo e($setting->chart_template); ?>";
        var chart_color = "<?php echo e($setting->highlight_color); ?>";
        var text_color = "<?php echo e($setting->text_color); ?>";
        var filter_value = "<?php echo e($setting->view_option); ?>";
        var price_value = [];
        var volume_value = [];
        $.ajax({
            url: '/admin/stock/get-data',
            async: false,
            type: "POST",
            data: { 'filter_value': filter_value},
                success: function(data) {
                    //console.log(data);
                    //value = data;
                    var price_arr = [];
                    var volume_arr = [];
                    for (var i in data){
                        price_arr = {
                                'x' : new Date(data[i].x),
                                'y' : data[i].price
                                };
                        volume_arr = {
                                'x' : new Date(data[i].x),
                                'y' : data[i].volume
                                };
                        price_value[i] = price_arr; 
                        volume_value[i] = volume_arr; 
                    }
                    
                    //console.log(price_arr);
                    }
            });
        var chart = new CanvasJS.Chart("chartContainer",
            {      
              // title:{
              //   text: "Twitter Mentions for iPhone and Samsung"
              // },
              zoomEnabled: true, 
              animationEnabled: true,
              axisY:{ 
                title: "Price",
                //includeZero: false,
                suffix : "$",
                lineColor: '#9CCFD7',    
              },
              axisY2:{ 
                title: "Volume",
                //includeZero: false,
                suffix : " m",
                lineColor: "#E1A4A2"
              },
              axisX:{ 
                gridThickness: 1,
                gridColor: "lightgrey",
                labelFontColor: text_color,
              },

              toolTip: {
                shared: "true"
              },
              data: [
              {        
                type: chart_type, 
                name: "Stock",
                color: '#9CCFD7',
                markerSize: 0,        
                dataPoints: price_value,
              },
              {        
                type: chart_type, 
                name: "Volume",
                color: '#E1A4A2',
                axisYType: "secondary",
                markerSize: 0,        
                dataPoints: volume_value,
              },
             
              ]
            });
        chart.render();
    }

 $('#btn-refresh').click(function(){
 	location.reload();
 });
 $('#remove_api').click(function(){
    if(confirm('Are you sure you want to remove this API?')){
        $('#frm_remove_api').submit();
    }
 });

 </script>

<?php $__env->stopSection(); ?>
<?php echo $__env->make($app_template['client.backend'], array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>