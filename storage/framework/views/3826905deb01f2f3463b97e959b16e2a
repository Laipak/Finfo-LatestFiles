<?php $__env->startSection('title'); ?>
Annual Report
<?php $__env->stopSection(); ?>
<?php $__env->startSection('content'); ?>
    <section class="content" id="financial-annual-report">
        <div class="row head-search">
            <div class="col-sm-6">
                <lable class="label-title">Upload Annual Report</lable>
            </div>
        </div>
        <div class="row">
            <?php echo Form::open(array('route' => 'package.admin.financial-annual-reports.save', 'method' => 'post','id' => 'myform', 'files'=> true)); ?>

            <div class="col-md-6">
                    <div class="form-group">
                            <?php echo Form::label('title', 'Title'); ?>

                            <?php echo Form::text('title', Input::old('title'), ['class' => 'form-control', 'required' => 'true', 'placeholder' => 'Title', 'minlength' => 5 , 'maxlength'=>50,]); ?>

                            <?php echo $errors->first('title', '<span class="help-block">:message</span>'); ?>

                    </div>

                    <div class="form-group">
                        <?php echo Form::label('file_upload', 'Upload PDF'); ?>

                        <div class="form-group">
                            <input type="file" class="hidden" accept="application/pdf" id="file" name="myfile">
                            <div class="row">
                                <div class="col-xs-8 upload-file">
                                    <?php echo Form::text('file_upload', Input::old('file_upload'), ['class' => 'file-upload-input form-control','required' => 'true', 'placeholder' => 'Support only pdf', 'id' => 'file_upload', 'readonly' => '']); ?>

                                </div>
                                <div class="col-xs-4 div-sel-file">
                                    <button type="button" class="btn btn-upload upload-file">Select File</button>
                                </div>
                            </div>
                            <?php echo $errors->first('file_upload', '<span class="help-block">:message</span>'); ?>

                        </div>
                    </div>

                    <div class="form-group">
                            <?php echo Form::label('description', 'Description'); ?>

                            <?php echo Form::textarea('description', Input::old('description'), ['class' => 'form-control', 'required' => 'true','placeholder' => 'Description', 'minlength' => 5 , 'maxlength'=>100,]); ?>

                            <?php echo $errors->first('description', '<span class="help-block">:message</span>'); ?>

                    </div>
                   
                    <div class="form-group">
                            <?php echo Form::label('financial_year', 'Financial year'); ?>

                            <?php echo Form::select('financial_year', $year, '', array('class' => 'form-control','required' => 'true',)); ?>

                            <?php echo $errors->first('financial_year', '<span class="help-block">:message</span>'); ?>

                    </div>
                    <div class="form-group">
                            <?php echo Form::label('publish_date', 'Publish date'); ?>

                                <?php echo Form::text('publish_date', Input::old('publish_date'), 
                                    ['class' => 'form-control publish_date', 'required' => 'true', 'placeholder' => 'Publish date', 'minlength' => 5 , 'maxlength'=>50,]); ?>

                            <?php echo $errors->first('publish_date', '<span class="help-block">:message</span>'); ?>

                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <?php echo Form::label('cover_image', 'Upload cover image'); ?>

                                <a class="text-right text-red remove-cover" href="#" title="Remove"><i class="fa fa-trash-o fa-lg" style="color:red"></i></a>
                                <div class="cover_image"></div>
                                <input type="file"  class="hidden" id="file_image" name="file_image" accept="image/gif, image/jpeg, image/png">
                                <input type='hidden' id="cover_image" value="<?php echo e(Input::old('cover_image')); ?>" name="cover_image"> 
                                <?php echo $errors->first('cover_image', '<span class="help-block">:message</span>'); ?>

                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:30px;">
                        <?php echo Form::submit('Save', ['class' => 'btn btn-primary btn-save']); ?>



                          <?php  $actual_link = (isset($_SERVER['HTTPS']) ? "https" : "http") . "://$_SERVER[HTTP_HOST]/annual-report";  ?> 
                        <a href="<?php echo e(route('package.admin.financial-annual-reports')); ?>" class="btn btn-danger btn-overwrite-cancel">Cancel</a>

                   
                      <input type="button" class='btn btn-primary btn-overwrite-cancel' id="button" value="Preview">
                    </div>
                 
            </div>
<?php  $actual_link = (isset($_SERVER['HTTPS']) ? "https" : "http") . "://$_SERVER[HTTP_HOST]/annual-report";  ?>
            
            
            <?php echo Form::close(); ?>

        </div>
    </section>
<?php $__env->stopSection(); ?>
<?php $__env->startSection('style'); ?>
    <?php echo Html::style('css/package/financial-annual-report.css'); ?>

    <?php echo Html::style('css/bootstrap-datetimepicker.min.css'); ?>

    <?php echo Html::style('//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css'); ?>

<?php $__env->stopSection(); ?>

<?php $__env->startSection('script'); ?>

<meta name="_token" content="<?php echo csrf_token(); ?>"/>
<?php echo Html::script('js/moment.min.js'); ?>

<?php echo Html::script('js/bootstrap-datetimepicker.min.js'); ?>

<?php echo Html::script('js/jquery.validate.min.js'); ?>







<script type="text/javascript">
$.ajaxSetup({
   headers: { 'X-CSRF-Token' : $('meta[name=_token]').attr('content') }
});
</script>
<script>
$(document).ready(function(){
function toObject(arr) {
  var rv = {};
  for (var i = 0; i < arr.length; ++i)
    rv[i] = arr[i];
  return rv;
}












  $("#button").on('click', function(e) {
        e.preventDefault();
        
      var formvalid = $("#myform").valid();
  		var form = jQuery('#myform');
        var dataString = form.serializeArray();
        dataString.push({'name': 'preview','value': 'value'});
        var formAction = form.attr('action');


if(formvalid)

        $.ajax({
                type: "POST",
                url : formAction,
                data : dataString,
               
                success : function(data){
                  
                window.open('<?php echo  $actual_link ?>'); 
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                    }
                    alert(msg);
                },
            });
    
      });
});
</script>








<script type="text/javascript">
    $(function(){
        $('.publish_date').datepicker({
            dateFormat: "dd M yy"
        });
    });
    $('.active').removeClass('active');
    $('.fin_ann_rp').addClass('active');
    $('.fin_ann_rp_form').addClass('active');
    
    $('#date, #public-date').datetimepicker({
        format: 'DD/MM/YYYY'
    });

    $('.upload-file').click(function(){
        $('#file').click();
    });

    $('.cover_image').click(function(){
        $('#file_image').click();
    });

    $('#file').change(function(e) {
        $('#file_upload').val('');

        var file = this.files[0];
        var filetype = file.type;
        var filesize = file.size;
        var filename = file.name;

        var match = ["application/pdf"];
        if (!((filetype == match[0]))) {
            alert('Please select pdf file.');
            if ('function' == typeof pCallback) {
                pCallback(false);
            }
            return;
        }


        // if (4000000 < filesize) {
        //     alert('File size should be less than 4MB.');
        //     $('#file').val('');
        //     if ('function' == typeof pCallback) {
        //         pCallback(false);
        //     }
        //     return;
        // }
        
        $('#file_upload').val(filename);
        
    });

    $('#file_image').change(function() {
        var file = this.files[0];
        var imagefile = file.type;


        var match = ["image/jpeg", "image/png", "image/jpg"];
        // validate file extension
        if (!((imagefile == match[0]) || (imagefile == match[1]) || (imagefile == match[2]))) {
            alert('Please select image file.');
            $('#file_image').val('');
            return false;
        }



        var formData = new FormData($('#frm-reports')[0]);
        $.ajax({
            url: baseUrl + '/admin/financial-annual-reports/temp-cover-image',
            processData: false,
            contentType: false,
            type: "POST",
            data: formData,
            success: function(data) {
                console.log(data);
                $('#cover_image').val(data);
                $('.cover_image').html("<img src='/"+data+"' style='width:100%;'>");
            }
        });
    });

    var cover_image = $('#cover_image').val();
    if(cover_image != ''){
        $('.cover_image').html("<img src='/"+cover_image+"' style='width:100%;'>");
    }

    $("#frm-reports").validate({
        rules: {
            'title': 'required',
            'file_upload': 'required',
            'financial_year': 'required'
        },

        submitHandler: function(form) {
            form.submit();
        }
    });
    $('.remove-cover').click(function(e){
        e.preventDefault();
        $('#cover_image').val('');
        $('.cover_image img').remove();
    });
</script>

<?php $__env->stopSection(); ?>

<?php echo $__env->make($app_template['client.backend'], array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>