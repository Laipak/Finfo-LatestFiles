<?php $__env->startSection('content'); ?>
  <section class="content" id="list-user">
    <div class="row head-search">
      <div class="col-sm-6">
        <h2 style="margin:0;">Client List</h2>
      </div>
      <div class="col-sm-6">
        <div class="pull-right">
<!--
          <a href="#" class="btn btn-primary btn-flat" style="padding: 4px 10px;">
                      <i class="fa fa-plus"></i> New User
                  </a>
                  <a href="#" class="btn btn-danger btn-flat" style="padding: 4px 10px;">
                      <i class="fa fa-trash"></i> Deleted
                  </a>
                  <a href="#" class="btn btn-success btn-flat" style="padding: 4px 10px;">
                      <i class="fa fa-eye"></i> Publish
                  </a>
                  <a href="#" class="btn btn-warning btn-flat" style="padding: 4px 10px;">
                      <i class="fa fa-eye-slash"></i> Unpublish
                  </a>
-->
        </div>
      </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <?php if(Session::has('global')): ?>
                <div class="alert alert-success">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <?php echo e(Session::get('global')); ?>

                </div>
                <?php endif; ?>

              <div class="box">
                <div id="box-user" class="box-body">
<!--                    <div class='row'  style='padding-bottom: 20px;'>
                        <div class='col-md-12 pull-right' >
                            <table>
                                <tr>
                                    <td><label style='font-weight:normal; color: #000; padding-right:5px;'>Status</label></td>
                                    <td>
                                        <select name='statusFilter' id='statusFilter' class='form-control'>
                                            <option value='pending'>Pending</option>
                                            <option value='rejected'>Rejected</option>
                                            <option value='expired'>Expired</option>
                                        </select>
                                    </td>
                                </tr>
                            </table>  
                        </div>
                    </div>-->
                    <table id="table-user" class="table table-bordered table-striped">
                          <thead>
                          <tr class="table-header">
                            <th class="hid">NÂº</th>
                              <th>Client Name</th>                              
                              <th>Company Phone Number</th>                              
                              <th>Email</th>
                              <th>Company Account Name</th>
                                <th>Package</th>
                              <th>Status</th>
                              <th>Registration Date</th>
                              <th>Expired Date</th>
                              <th>Actions</th>
                          </tr>
                          </thead>
                          <tbody>
                          <?php $i= 1; ?>
                          <?php foreach($data['client'] as $client): ?>     
                              <tr>
                                <td width="15px" class="text-center"><?php echo e($i); ?></td>
                                  <td>
                                        <a href="<?php echo e(route('finfo.admin.clients.detail', $client['id'])); ?>">
                                        <?php echo e($client['first_name'].' '.$client['last_name']); ?>

                                        </a>
                                    </td>
                                  <td><?php echo e($client['phone']); ?></td>
                                  <td><?php echo e($client['email_address']); ?></td>
                                  <td><ol>
                                            <li><?php echo e($client['finfo_account_name1']); ?></li>
                                            <li><?php echo e($client['finfo_account_name2']); ?></li>
                                        </ol></td>
                                    <td><?php echo e($client['title']); ?></td>
                                    <td><h4><?php echo $controller->getClientStatus($client['id'], $client['expire_date'] ); ?></h4></td>
                                <td><?php echo e(date('d-M-Y', strtotime($client['created_at']))); ?></td>
                                <td><?php echo e(date('d-M-Y', strtotime($client['expire_date']))); ?></td>
                                  <td>
                                        <?php if($client['approved_by']==0): ?>
                                        <button _id="<?php echo e($client['id']); ?>" _option1= "<?php echo e($client['finfo_account_name1']); ?>" _option2= "<?php echo e($client['finfo_account_name2']); ?>" class="btn btn-success btn-approve" style="padding: 4px 10px;">
                                            <i class="fa fa-check"></i> Approve
                                        </button>
                                        <?php endif; ?>
                                        <button _id="<?php echo e($client['id']); ?>" class="btn btn-danger btn-reject" style="padding: 4px 10px;">
                                         <i class="fa fa-close"></i> Reject
                                      </button>
                                        <a href="<?php echo e(URL::to('backend/admin/clients', $client['id'])); ?>" class="btn btn-default" style="padding: 4px 10px;">
                                         <i class="fa fa-pencil"></i> Edit
                                      </a>
                                    </td>
                              </tr>
                              <?php $i++; ?>
                          <?php endforeach; ?>
                          </tbody>
                      </table>
                    <div class="paginate pull-right">
                        <?php //echo $data['client']->render(); ?>
                    </div>
                </div>
              </div>
            </div>
        </div>

    </section>

<div class="modal fade"  id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog">
    <div class="modal-content">
      <?php echo Form::open(array('url' => route('finfo.admin.clients.approve'), 'method' => 'POST', 'id' => 'approve-form')); ?>

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Modal title</h4>
      </div>
      <div class="modal-body">
          <p>Which company account's name will be use for this account?</p>
          
        <div class="radio">
          <label class="option1">
            <input type="radio" name="option" value="">
            <span></span>
          </label>
          <p class=""></p>
</div>
<?php /*         <div class="radio">
          <label class="option2">
            <input type="radio" name="option" value="">
            <span></span>
          </label>
        </div> */ ?>
        <div class="radio">
          <label class="otherField">
            <input type="radio" name="option" value="" id="other">
            <span>Other</span>
            <input type="text" name="otherText" id="otherText" value="" placeholder="Account Name" style="display:none;">
            <span class="surrfix" name="surrfix" style="display:none;"></span>
            <span style="color: red" class="errorOtherText"></span>
          </label>
        </div>
        <label id="option-error" class="error" for="option"></label>
        <label id="otherText-error" class="error" for="otherText"></label>
        <p class="text-danger error-app" style="color:red;"></p>

        <div class="trail" id="trail-dev">
          <?php /*<div class="checkbox">
             <label>
                <input type="checkbox" name="trail" value="1" id="trail-enable">  Trial period
             </label>
          </div>*/ ?>
          <P style="font-weight: 600;">Trial Date:</P>
          <div class="content-trail-date">
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group">
                    <label class="control-label" style="font-weight: 500;">Start date</label>
                      <input type="text" class="form-control" id="start_trail" name="start_trail"  >
                </div>
                <p id="start_trail-error" class="has-error"></p>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                    <label class="control-label" style="font-weight: 500;">End date</label>
                      <input type="text" class="form-control" id="end_trail" name="end_trail"  >
                </div>
                <p id="end_trail-error" class="has-error"></p>
              </div>
            </div>
          </div>
        </div>

        <textarea class="form-control" placeholder="Your Message" name="description"></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Approve</button>
        <input type="hidden" id="h_id" name="h_id" value="">
        <input type="hidden" id="market" name="market" >
      </div>
        <?php echo Form::close(); ?>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<div class="modal fade"  id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog">
    <div class="modal-content">
     <?php echo Form::open(array('url' => route('finfo.admin.clients.reject'), 'method' => 'POST', 'id' => 'reject-form')); ?>

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Reject Company</h4>
      </div>
      <div class="modal-body">
        <p>Give them a reason why you reject them?</p>
        <textarea name="message" class="form-control <?php echo e($errors->has('company_name') ? ' has-error' : ''); ?>" placeholder="Your Message"></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Reject</button>
        <input type="hidden" id="r_id" name="r_id" value="">
      </div>
    <?php echo Form::close(); ?>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>

<?php $__env->stopSection(); ?>
<?php $__env->startSection('style'); ?>
  <?php echo Html::style('backend/css/bootstrap-datetimepicker.min.css'); ?>

  <?php echo Html::style('backend/css/finfo/list-user.css'); ?>

  <?php echo Html::style('backend/css/dataTables.bootstrap.min.css'); ?>

  
  <style>
    .has-error, .error { 
      color: red;
      font-weight: 500;
    }
  </style>
<?php $__env->stopSection(); ?>

<?php $__env->startSection('script'); ?>

<?php echo Html::script('backend/js/jquery.dataTables.min.js'); ?>

<?php echo Html::script('backend/js/dataTables.bootstrap.min.js'); ?>

<?php echo Html::script('backend/js/jquery.validate.min.js'); ?>

<?php echo Html::script('backend/js/moment.min.js'); ?>

<?php echo Html::script('backend/js/bootstrap-datetimepicker.min.js'); ?>


<script type="text/javascript">
    var baseUrl = "<?php echo e(URL::to('/')); ?>";
    $.ajaxSetup({
        headers:{
            'X-CSRF-TOKEN':'<?php echo csrf_token(); ?>'
        }
    });

    $('#start_trail').datetimepicker({
        format: 'DD-MM-YYYY',
        minDate: moment().millisecond(0).second(0).minute(0).hour(0),
    });
    $('#end_trail').datetimepicker({
        minDate: moment().millisecond(0).second(0).minute(0).hour(0),
        format: 'DD-MM-YYYY',
    });



    $('.btn-approve').click(function(){
        $('.modal-title').text("Company Approval");

        var surrfix = $(this).attr('_option1').split("-");
        $('#market').val(surrfix[surrfix.length-1]);
        $('.surrfix').text("-" + surrfix[surrfix.length-1]);
        $('.option1').find('span').text($(this).attr('_option1'));
        $('.option1').find('input').val($(this).attr('_option1'));
        // $('.option2').find('span').text($(this).attr('_option2'));
        // $('.option2').find('input').val($(this).attr('_option2'));
        $('#h_id').val($(this).attr('_id'));
        var client_id = $(this).attr('_id');
        
        $.ajax({
            url: baseUrl + '/backend/admin/clients/check/client_payment',
            type: "post",
            data: {'client_id': client_id} ,
            success: function(data) {
              if(data == 0){
                $('#trail-dev').show();
              }else{
                $('#trail-dev').hide();
              }
              
              $('#myModal').modal('show');
            },
        });
    });

    $('.btn-reject').click(function(){        
        $('#r_id').val($(this).attr('_id'));
        $('#myModal2').modal('show');
    });

    $('#otherText').keyup(function(){
        $('#other').val($(this).val());
    });

    $('input:radio[name="option"]').change(
        function(){
            if ($(this).is(':checked') && $(this).attr('id')=="other"){
                $('#otherText').show();
                $('.surrfix').show();
            }else{
                $('#otherText-error').text('');
                $('#otherText').val('');
                $('#other').val('');
                $('#otherText').hide();
                $('.surrfix').hide();
            }
    });
  
  $( window ).resize(function() {
    var screen = $(window).width();
    if(screen < 770){
      $('#box-user').addClass('table-responsive');
    }else{
      $('#box-user').removeClass('table-responsive');
    }
  });
  $("#table-user").dataTable();
//    $.fn.dataTable.ext.search.push(
//        function( settings, data, dataIndex ) {
//            var status = $('#statusFilter').val();
//            alert( data[6]);
//            var age = parseFloat( data[6] ) || 0; // use data for the age column
//            alert( )
//            if ( age == status ) {
//                return true;
//            }
//            return false;
//        }
//    );
//  $(function () {
//        var table = $("#table-user").dataTable();
//        $('#statusFilter').change( function() {
//            table.draw();
//        });
//    });

  $("#table-user").on("click",".check-all:checked",function(){
    $(".check-user:checkbox:not(:checked)").click(); 
  });

  $('.check-all:not(:checked)').click(function(){
    
    $(".check-user:checkbox:checked").click(); 
  });

  jQuery.validator.addMethod("noSpace", function(value, element) { 
      return value.indexOf(" ") < 0 || value.indexOf(/([!,%,&,@,#,$,^,*,?,_,~])/) < 0 ; 
    }, "Cannot use space in this field.");


    $.validator.addMethod("regex", function(value, element, regexp) {
        if (value.indexOf(".") !== -1) {
            return false;
        }
        var check = false;
        var re = new RegExp(regexp);
        return this.optional(element) || re.test(value);
    },"No special Characters allowed here.");


    $.validator.addMethod('lowercase', function(value) {
        return value.match(/^[^A-Z]+$/);
    }, 'No Capital letter allowed here.');

  $("#reject-form").validate({
        rules: {
            message: {
                required: true
            },
        },
        messages: {            
            message: {
                required: "<p style='color: red;' class='error-reject'>Please provide your reason</p>"
            },
        }
  });

  $("#approve-form").validate({        
        // errorClass: 'has-error',
        // highlight: function (element, errorClass) { 
        //     $(element).closest("label.otherField").addClass(errorClass);
        // },
        // unhighlight: function (element, errorClass) { 
        //     $(element).closest("label.otherField").removeClass(errorClass); 
        // },
        rules: {
            option: {
                required: true
            },
            otherText: {
                required: true,
                maxlength: 20,
                minlength: 6,
                noSpace: true,
                lowercase: true,
                regex: /^[A-Za-z0-9\.-]+$/,
                remote: {
                            url: '/backend/register/check/domain_name',
                            type: "post",
                            data:   {
                                        name: function()
                                            {
                                                return $('#approve-form :input[name="otherText"]').val() + '-' + $('#market').val();
                                            }
                                    }
                        }
            },
            end_trail: 'required',
            start_trail: 'required',
        },
        messages: {
          otherText: {
            remote: "account name already in use!",
            required: 'Account name field is required',
          },
          option: {
            required: 'Please choose one of account names'
          }
        },
        //errorElement : 'p',
        //errorLabelContainer: '.text-danger',
        submitHandler: function(form) {
          form.submit();
        }
  });

  $('#myModal2').on('hidden.bs.modal', function() {
      $('.error-reject').remove();
  });

   $('#myModal').on('hidden.bs.modal', function() {
      $('.error-app').html('');
      $('.error').text('');
      $('#start_trail').val('');
      $('#end_trail').val('');
  });

  $("body").on("click","#trail-enable:checked",function(){
      $('.content-trail-date').show();
  });

  $("body").on("click","#trail-enable:not(:checked)",function(){
      $('.content-trail-date').hide();
  });
  
</script>

<?php $__env->stopSection(); ?>

<?php echo $__env->make($app_template['backend'], array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>